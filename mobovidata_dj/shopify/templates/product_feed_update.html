{% extends "base.html" %}
{% load staticfiles i18n %}

{% block content %}
    <div class="row">
        <h1>Product feed exclusion</h1>
    </div>
    <div class="alert alert-info alert-dismissible" role="alert">
      <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <strong>Important information!</strong> Here's an <a href="{% static 'other/product_feed_exclusion_update_example.csv' %}">example of file</a>. Your file should look similar to this, respecting header's names.
    </div>
    <div class="row" ng-controller="ProductFeedExclusionUpdateController">
        <div class="col-sm-10">
            <form id="uploadFileForm" name="uploadFileForm" action="" method="post" enctype="multipart/form-data">
                {% csrf_token %}
              <div class="form-group">
                <label for="UploadFile">Upload file here</label>
                <input type="file" class="form-control-file" aria-describedby="fileHelp" file-model="myFile">
                <small id="fileHelp" class="form-text text-muted">Please note, CSV file only</small>
              </div>
              <div class="form-group row">
                <label for="selShopifyStore" class="col-sm-2 form-control-label text-right">Shopify store</label>
                <div class="col-sm-10">
                    <select class="form-control" id="selShopifyStore" name="shopifyStore"
                    ng-options="store.name for store in stores track by store.id"
                    ng-model="selectedStore">
                    </select>
                </div>
            </div>
              <button type="button" class="btn serenity" ng-click="uploadFile()" ng-disabled="uploadFileForm.$invalid">Upload
                <i class="fa fa-spinner fa-pulse" ng-show="loading"></i>
              </button>
            </form>
        </div>
        <div class="row" ng-if="finished && !success">
            <div class="col-sm-8 col-sm-offset-2">
                <div class="alert tango-tangerine text-center text-white">
                    <i class="fa fa-check-circle"></i>&nbsp;[[ message ]]
                </div>
            </div>
        </div>

        <div class="col-sm-12" ng-if="finished && success">
            <hr>
            <h1>Summary</h1>
            <h4>Excluded SKUs: [[processed_variants_counter]]</h4>
            <h4>Non excluded SKUs: [[non_processed_variants.length]]</h4>
            <hr>
            <table class="table table-striped table-bordered" ng-show="non_processed_variants.length" style="width:100%;">
                <thead class="thead-inverse">
                    <tr>
                        <th>Variant&nbsp;SKU&nbsp;</th>
                        <th>Reason&nbsp;</th>
                   </tr>
                </thead>
                <tr ng-repeat="variant in non_processed_variants">
                    <td>[[variant.sku]]</td>
                    <td>[[variant.reason]]</td>
                </tr>
            </table>
        </div>
    </div>

    <script>
        window.shopify_data = {};
        window.shopify_data.uploadEndpoint = '{% url 'shopify:product-feed-exclusion-update' %}';
        window.shopify_data.stores = {{ stores|safe }};
    </script>
{% endblock %}
