{% extends "base.html" %}
{% load staticfiles i18n %}

{% block content %}
    <div class="row">
        <div class="col-sm-12">
            <h1>Update Inventory supplier mapping</h1>
            <hr/>
        </div>
    </div>

    <div class="alert alert-info alert-dismissible" role="alert">
      <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <strong>Important information!</strong> Here's an <a href="{% static 'other/inventory_supplier_mapping_update_example.csv' %}">example of file</a>. Your file must look similar to this, respecting header's names.
        <br/><br/><strong>Note 1: </strong>Supplier and SKU must exist for that Store on MVD DB.
        <br/><br/><strong>Note 2: </strong>Cost column is optional.
    </div>

    <div class="row" ng-controller="InventorySupplierMappingBulkUpdateController">
        <div class="col-sm-10">
            <form id="uploadFileForm" name="uploadFileForm" action="" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="form-group">
                    <label for="UploadFile">Upload file here</label>
                    <input type="file" class="form-control-file" aria-describedby="fileHelp" file-model="myFile">
                    <small id="fileHelp" class="form-text text-muted">Please note, CSV file only</small>
                </div>
                <div class="form-group row">
                    <label for="selShopifyStore" class="col-sm-2 form-control-label text-right">Shopify store</label>
                    <div class="col-sm-10">
                        <select class="form-control" id="selShopifyStore" name="shopifyStore"
                        ng-options="store.name for store in stores track by store.id"
                        ng-model="selectedStore">
                        </select>
                    </div>
                </div>
                <button type="button" class="btn serenity" ng-click="uploadFile()" ng-disabled="uploadFileForm.$invalid">Upload
                    <i class="fa fa-spinner fa-pulse" ng-show="loading"></i>
                </button>
            </form>
        </div>
        <div class="row" ng-if="finished && !success">
            <div class="col-sm-8 col-sm-offset-2">
                <div class="alert tango-tangerine text-center text-white">
                    <i class="fa fa-check-circle"></i>&nbsp;[[ message ]]
                </div>
            </div>
        </div>

        <div class="col-sm-12" ng-if="finished && success">
            <hr>
            <h1>Summary</h1>

            <p ng-hide="[[non_processed.length]]==0">NOTE: Mapping won't be updated until errors dissappear.</p>
            <p ng-show="[[non_processed.length]]==0">Mapping updated succesfully. Check mapping here: <a href="{% url 'admin:shopify_inventorysuppliermapping_changelist' %}">Link to admin</a>.</p>
            <h4>Successful mappings: [[processed_counter]]</h4>
            <h4>Non processed mappings: [[non_processed.length]]</h4>
            <table class="table table-striped table-bordered" ng-show="non_processed.length" style="width:100%;">
                <thead class="thead-inverse">
                    <tr>
                        <th>Row</th>
                        <th>Reason&nbsp;</th>
                   </tr>
                </thead>
                <tr ng-repeat="obj in non_processed">
                    <td>[[obj.row]]</td>
                    <td>[[obj.reason]]</td>
                </tr>
            </table>
        </div>
    </div>

    <script>
        window.shopify_data = {};
        window.shopify_data.uploadEndpoint = '{% url 'shopify:update-inventory-supplier-mapping-bulk' %}';
        window.shopify_data.stores = {{ stores|safe }};
    </script>
{% endblock %}
