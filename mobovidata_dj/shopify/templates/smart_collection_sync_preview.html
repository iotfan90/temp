{% extends "base.html" %}
{% block content %}
    <div ng-controller="SmartCollectionSyncController">
        <div class="row">
            <div class="col-lg-12">
                <div class="row">
                    <div class="col-lg-9">
                        <h1>Smart collections sync preview</h1>
                    </div>
                </div>

                <div class="row">
                    {% if last_smart_collections_sync_mins > 10 %}
                        <hr>
                        <div class="jumbotron">
                          <div class="container">
                              <h2>Sync local smart collections with shopify:</h2>
                              <p>Smart collections where synced for last time on <strong>{{ last_sync_date }} ({{ last_smart_collections_sync_mins }} minutes ago)</strong>. </p>
                              <p>Please, press <strong>Sync button</strong> and get all new/modified/deleted smart collections from Shopify, updating MVD Database.</p>
                              <p>
                                  <button class="btn radiant-orchid btn-lg" ng-click="syncSmartCollections()" ng-disabled="loadingSyncSmartCollections">Sync
                                    <i class="fa fa-spinner fa-pulse" ng-show="loadingSyncSmartCollections"></i>
                                  </button>
                              </p>
                              <div ng-show="syncSmartCollectionsResponse" class="alert" ng-class="syncSmartCollectionsResponse.success ? 'alert-success' : 'alert-danger'" role="alert">
                                  [[syncSmartCollectionsResponse.message]]
                              </div>
                          </div>
                        </div>
                    {% endif %}

                    <hr>
                    <div class="input-group">
                        <h4>Store: {{ store_name }}</h4>
                        <h4>New collections: [[collections.length]]</h4>
                        <h4>Collections uploaded: [[upload_counter]]</h4>
                        <span class="input-group-btn">
                            <button class="btn serenity"
                                    ng-click="uploadAllCollection()"
                                    ng-disabled="uploadingAllCollection">Update All
                                <i class="fa fa-spinner fa-pulse" ng-show="uploadingAllCollection"></i>
                            </button>
                        </span>
                    </div>
                    <hr>

                    <div class="row" id="products">
                        <div class="col-lg-12">
                            <table class="table table-striped table-bordered">
                                <thead class="thead-inverse">
                                    <tr>
                                        <th>More Info</th>
                                        <th>Brand</th>
                                        <th>Model</th>
                                        <th>Collection Handle</th>
                                        <th>Update</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat-start="collection in collections" ng-if="collections.length">
                                        <td>
                                          <button ng-if="collection.expanded" ng-click="collection.expanded = false">
                                              <i class="fa fa-minus"></i>
                                          </button>
                                          <button ng-if="!collection.expanded" ng-click="collection.expanded = true">
                                              <i class="fa fa-plus"></i>
                                          </button>
                                        </td>
                                        <td>[[collection.brand__name]]</td>
                                        <td>[[collection.model]]</td>
                                        <td>[[collection.collection_handle]]</td>
                                        <td>
                                            <button type="button" class="right btn text-white"
                                                    ng-class="!collection.uploaded ? 'serenity' : (collection.success ? 'emerald' : 'tango-tangerine')"
                                                    ng-click="uploadCollection(collection)"
                                                    ng-disabled="collection.uploading || collection.success">
                                                <i class="fa fa-upload" ng-hide="collection.uploading"></i>
                                                <i class="fa fa-spinner fa-pulse" ng-show="collection.uploading"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr ng-if="collection.expanded" ng-repeat-end="">
                                        <th></th>
                                        <th>Message</th>
                                        <td colspan="3">[[collection.message]]</td>
                                    </tr>
                                    <tr ng-if="trackRows.length == 0">
                                        <td colspan="4">
                                            No Info Found
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        window.shopify_data = {};
        window.shopify_data.collections = {{ collections|safe }};
        window.smart_collections_upload_endpoint = '{% url 'shopify:upload-new-model-to-shopify' %}';
        window.smart_collections_sync_endpoint = '{% url 'shopify:more-actions-sync-smart-collections' %}';
    </script>
{% endblock %}
