{% extends "base.html" %}
{% load staticfiles i18n %}

{% block content %}
    <div class="row">
        <h1> Models update </h1>
    </div>
    <div class="alert alert-info alert-dismissible" role="alert">
      <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <strong>Important information!</strong> Here's an <a href="{% static 'other/models_update_example.csv' %}">example of file</a>. Your file should look similar to this, respecting header's names.
        <br/><br/><strong>Note 1: </strong>Empty columns will replace the existing values of the model with None.
        <br/><br/><strong>Note 2: </strong>Categories are separated by character <strong>'|'</strong>. (ie: Replacement Batteries and Power Banks | Laptop Cases & Covers | Screen Protectors)
        <br/><br/><strong>Note 3: </strong>Booleans are <strong>1 for True</strong> and <strong>o for False</strong>.
    </div>
    <div class="row" ng-controller="ModelsBulkUpdateController">
        <div class="col-sm-10">
            <form id="uploadFileForm" name="uploadFileForm" action="" method="post" enctype="multipart/form-data">
                {% csrf_token %}
              <div class="form-group">
                <label for="UploadFile">Upload file here</label>
                <input type="file" class="form-control-file" aria-describedby="fileHelp" file-model="myFile">
                <small id="fileHelp" class="form-text text-muted">Please note, CSV file only</small>
              </div>

              <button type="button" class="btn serenity" ng-click="uploadFile()" ng-disabled="uploadFileForm.$invalid">Upload
                <i class="fa fa-spinner fa-pulse" ng-show="loading"></i>
              </button>
            </form>
        </div>
        <div class="row" ng-if="finished && !success">
            <div class="col-sm-8 col-sm-offset-2">
                <div class="alert tango-tangerine text-center text-white">
                    <i class="fa fa-check-circle"></i>&nbsp;[[ message ]]
                </div>
            </div>
        </div>

        <div class="col-sm-12" ng-if="finished && success">
            <hr>
            <h1>Summary</h1>
            <h4>Updated models: [[processed_models_counter]]</h4>
            <h4>Non updated models: [[non_processed_models.length]]</h4>
            <hr>
            <table class="table table-striped table-bordered" ng-show="non_processed_models.length">
                <thead class="thead-inverse">
                    <tr>
                        <th>Handle</th>
                        <th>Reason&nbsp;</th>
                   </tr>
                </thead>
                <tr ng-repeat="model in non_processed_models">
                    <td>[[model.handle]]</td>
                    <td>[[model.reason]]</td>
                </tr>
            </table>
        </div>
    </div>

    <script>
        window.shopify_data = {};
        window.shopify_data.uploadEndpoint = '{% url 'shopify:update-model-bulk' %}';
    </script>
{% endblock %}
